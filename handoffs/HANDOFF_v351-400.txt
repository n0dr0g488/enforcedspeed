EnforcedSpeed — Handoff Notes (v351–v400)

v356 (2026-02-16)
Goal
- Fix the right-rail “Trending Counties” so it always populates with 5 counties and renders correctly.
- Remove the star/follow UI from the right rail (follow UX will be added later).

What changed
1) Trending Counties now always shows 5 rows
- The backend already builds a “chosen” list from recent/trending data.
- New fallback: if there are still <5 unique counties, we fill the remaining slots using the top counties overall (by total report count, then most recent report), excluding duplicates.

2) Template fix (this was the main visible bug)
- The Trending/Follow list HTML had broken nesting/closing tags, causing only 1 row to appear.
- Rebuilt both lists as simple “name left / counts right” flex rows.

3) Stars removed from right rail
- Removed the star buttons + follow toggle JS from the right-rail panel.
- Follow feature will be implemented later in a dedicated pass.

Files touched
- app.py
- templates/home_feed.html
- VERSION.txt
- changelogs/CHANGELOG_v351-360.txt
- handoffs/HANDOFF_v351-400.txt

Local run (standard)
- Use your normal startup: es-up (preferred) or es-app.

Deploy (Render)
- Going live = git add/commit/push to GitHub.
- Check BOTH Render services:
  - Web service logs (gunicorn)
  - Worker service logs (RQ) (must be running for OCR jobs)

Git commands
- git add -A
- git commit -m "v356: Fix Trending Counties (always 5 rows) + remove stars"
- git push origin main

v357 — Home right-rail styling
- Make right rail flush + sharp edges like left filter rail; keep mini-map block separate from trending/follow block with divider.


v358 — Home mini-map static trending counties
- Replace interactive home mini-map with a static Google Static Maps image.
- Mini-map plots up to 20 unique trending counties at county centroid/center (no ticket pins); falls back to recent/top counties.
- Remove mini-map title; click-anywhere opens /map; keep small 'Open full map' overlay.
v360: Home right-rail trending minimap was broken (500) due to missing requests import; fixed.

v361 (2026-02-16)
GOAL
- Fix home right-rail static minimap image not loading (likely 500 due to county center DB query param binding).

CHANGES
- app.py
  - /api/home_minimap_staticmap: replace Postgres ANY(:geoids) with SQLAlchemy expanding IN :geoids bindparam for driver compatibility.
  - Add debug=1 mode that returns JSON describing chosen geoids, resolved county center points, and the exact upstream Google Static Maps URL/status.
  - Return upstream Content-Type and set Cache-Control: public, max-age=300.

HOW TO TEST (PROD)
1) Open home page and confirm the right-rail minimap image loads.
2) If it does not load, open this in a browser (or curl) and check the JSON:
   /api/home_minimap_staticmap?debug=1
   - Verify chosen_geoids length is 5 and county_pts has lat/lngs.
   - Verify status_code=200 and content_type is image/png (or image/*).
